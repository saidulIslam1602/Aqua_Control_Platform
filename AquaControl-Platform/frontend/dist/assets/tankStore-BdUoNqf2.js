import{ax as j,r as k,c as g,w as H}from"./vue-vendor-DU8T2215.js";import{h as o,a as Q,u as G}from"./index-BgEO1XDn.js";class J{baseUrl="/api/tanks";async getTanks(t={}){const s=new URLSearchParams;t.page&&s.append("page",t.page.toString()),t.pageSize&&s.append("pageSize",t.pageSize.toString()),t.searchTerm&&s.append("searchTerm",t.searchTerm),t.tankType&&s.append("tankType",t.tankType),t.isActive!==void 0&&s.append("isActive",t.isActive.toString()),t.sortBy&&s.append("sortBy",t.sortBy),t.sortDescending&&s.append("sortDescending",t.sortDescending.toString());const f=`${this.baseUrl}?${s.toString()}`;return o.get(f)}async getTankById(t){return o.get(`${this.baseUrl}/${t}`)}async createTank(t){return o.post(this.baseUrl,t)}async updateTank(t,s){return o.put(`${this.baseUrl}/${t}`,s)}async deleteTank(t){return o.delete(`${this.baseUrl}/${t}`)}async activateTank(t){return o.post(`${this.baseUrl}/${t}/activate`)}async deactivateTank(t,s){return o.post(`${this.baseUrl}/${t}/deactivate`,{reason:s})}async scheduleMaintenance(t,s){return o.post(`${this.baseUrl}/${t}/schedule-maintenance`,{maintenanceDate:s})}async completeMaintenance(t,s,f){return o.post(`${this.baseUrl}/${t}/complete-maintenance`,{completionDate:s,notes:f})}async bulkActivate(t){return o.post(`${this.baseUrl}/bulk/activate`,{tankIds:t})}async bulkDeactivate(t,s){return o.post(`${this.baseUrl}/bulk/deactivate`,{tankIds:t,reason:s})}async bulkDelete(t){return o.post(`${this.baseUrl}/bulk/delete`,{tankIds:t})}async getTankAnalytics(t,s){return o.get(`${this.baseUrl}/${t}/analytics?timeRange=${s}`)}async getTankHealth(t){return o.get(`${this.baseUrl}/${t}/health`)}async exportTanks(t="csv"){await o.downloadFile(`${this.baseUrl}/export?format=${t}`,`tanks.${t}`)}async importTanks(t){return o.uploadFile(`${this.baseUrl}/import`,t)}}const y=new J;var w=(n=>(n.Inactive="Inactive",n.Active="Active",n.Maintenance="Maintenance",n.Emergency="Emergency",n.Cleaning="Cleaning",n))(w||{});const W=j("tanks",()=>{const n=k([]),t=k(null),s=k({loading:!1,error:null,lastUpdated:null}),f=k({page:1,pageSize:20,totalCount:0,totalPages:0,hasNextPage:!1,hasPreviousPage:!1}),c=k({searchTerm:"",tankType:void 0,isActive:void 0,sortBy:"name",sortDescending:!1}),u=k(new Map),v=Q(),b=G(),U=g(()=>n.value.filter(e=>e.status==="Active")),m=g(()=>n.value.filter(e=>e.status==="Inactive")),I=g(()=>n.value.filter(e=>e.nextMaintenanceDate&&new Date(e.nextMaintenanceDate)<=new Date)),x=g(()=>{const e=new Map;return n.value.forEach(a=>{const i=a.tankType;e.has(i)||e.set(i,[]),e.get(i).push(a)}),e}),D=g(()=>{let e=n.value;if(c.value.searchTerm){const a=c.value.searchTerm.toLowerCase();e=e.filter(i=>i.name.toLowerCase().includes(a)||i.location.building.toLowerCase().includes(a)||i.location.room.toLowerCase().includes(a))}if(c.value.tankType&&(e=e.filter(a=>a.tankType===c.value.tankType)),c.value.isActive!==void 0){const a=c.value.isActive?"Active":"Inactive";e=e.filter(i=>i.status===a)}return e}),$=g(()=>s.value.loading),A=g(()=>!!s.value.error),z=g(()=>n.value.length===0&&!$.value),S=async(e={})=>{s.value.loading=!0,s.value.error=null;try{const a={...c.value,...e},i=await y.getTanks(a);n.value=i.data,f.value=i.pagination,s.value.lastUpdated=new Date().toISOString(),Object.keys(e).length>0&&(c.value={...c.value,...e})}catch(a){s.value.error=a.message,v.addNotification({type:"error",title:"Failed to load tanks",message:a.message})}finally{s.value.loading=!1}},C=async e=>{const a=n.value.find(i=>i.id===e);if(a)return t.value=a,a;s.value.loading=!0,s.value.error=null;try{const l=(await y.getTankById(e)).data,r=n.value.findIndex(d=>d.id===e);return r===-1?n.value.push(l):n.value[r]=l,t.value=l,l}catch(i){return s.value.error=i.message,v.addNotification({type:"error",title:"Failed to load tank",message:i.message}),null}finally{s.value.loading=!1}},N=async e=>{const a=`temp-${Date.now()}`,i={id:a,name:e.name,capacity:{value:e.capacity,unit:e.capacityUnit},location:{building:e.building,room:e.room,zone:e.zone,latitude:e.latitude,longitude:e.longitude,fullAddress:`${e.building}, ${e.room}${e.zone?`, ${e.zone}`:""}`},tankType:e.tankType,status:w.Inactive,sensors:[],createdAt:new Date().toISOString(),version:1,isActive:!1,isMaintenanceDue:!1,sensorCount:0,activeSensorCount:0};n.value.unshift(i);const l=()=>{const r=n.value.findIndex(d=>d.id===a);r!==-1&&n.value.splice(r,1)};u.value.set(a,{id:a,type:"create",data:i,timestamp:new Date().toISOString(),rollback:l});try{const d=(await y.createTank(e)).data,T=n.value.findIndex(p=>p.id===a);return T!==-1&&(n.value[T]=d),u.value.delete(a),v.addNotification({type:"success",title:"Tank created",message:`Tank "${d.name}" has been created successfully`}),d}catch(r){return l(),u.value.delete(a),s.value.error=r.message,v.addNotification({type:"error",title:"Failed to create tank",message:r.message}),null}},B=async(e,a)=>{const i=n.value.find(p=>p.id===e);if(!i)return null;const l={...i,name:a.name,capacity:{value:a.capacity,unit:a.capacityUnit},location:{building:a.building,room:a.room,zone:a.zone,latitude:a.latitude,longitude:a.longitude,fullAddress:`${a.building}, ${a.room}${a.zone?`, ${a.zone}`:""}`},tankType:a.tankType,updatedAt:new Date().toISOString(),version:i.version+1},r=n.value.findIndex(p=>p.id===e),d=n.value[r];n.value[r]=l;const T=()=>{n.value[r]=d};u.value.set(e,{id:e,type:"update",data:l,timestamp:new Date().toISOString(),rollback:T});try{const h=(await y.updateTank(e,a)).data;return n.value[r]=h,t.value?.id===e&&(t.value=h),u.value.delete(e),v.addNotification({type:"success",title:"Tank updated",message:`Tank "${h.name}" has been updated successfully`}),h}catch(p){return T(),u.value.delete(e),s.value.error=p.message,v.addNotification({type:"error",title:"Failed to update tank",message:p.message}),null}},F=async e=>{const a=n.value.findIndex(r=>r.id===e);if(a===-1)return!1;const i=n.value[a];n.value.splice(a,1);const l=()=>{n.value.splice(a,0,i)};u.value.set(e,{id:e,type:"delete",data:i,timestamp:new Date().toISOString(),rollback:l});try{return await y.deleteTank(e),t.value?.id===e&&(t.value=null),u.value.delete(e),v.addNotification({type:"success",title:"Tank deleted",message:`Tank "${i.name}" has been deleted successfully`}),!0}catch(r){return l(),u.value.delete(e),s.value.error=r.message,v.addNotification({type:"error",title:"Failed to delete tank",message:r.message}),!1}},M=e=>{switch(e.eventType){case"TankCreated":n.value.find(l=>l.id===e.data.id)||n.value.push(e.data);break;case"TankUpdated":const a=n.value.findIndex(l=>l.id===e.data.id);a!==-1&&(n.value[a]=e.data,t.value?.id===e.data.id&&(t.value=e.data));break;case"TankDeleted":const i=n.value.findIndex(l=>l.id===e.data.id);i!==-1&&(n.value.splice(i,1),t.value?.id===e.data.id&&(t.value=null));break}},L=()=>{s.value.error=null},O=e=>{t.value=e},E=e=>{c.value={...c.value,...e}},P=()=>{c.value={searchTerm:"",tankType:void 0,isActive:void 0,sortBy:"name",sortDescending:!1}},R=()=>S(c.value);return H(()=>b.isConnected,e=>{e&&b.subscribe("TankUpdates",M)},{immediate:!0}),{tanks:n,selectedTank:t,state:s,pagination:f,filters:c,optimisticUpdates:u,activeTanks:U,inactiveTanks:m,maintenanceDueTanks:I,tanksByType:x,filteredTanks:D,isLoading:$,hasError:A,isEmpty:z,fetchTanks:S,fetchTankById:C,createTank:N,updateTank:B,deleteTank:F,clearError:L,setSelectedTank:O,updateFilters:E,resetFilters:P,refresh:R}},{persist:{key:"aquacontrol-tanks",storage:localStorage,paths:["filters","pagination.pageSize"]}});export{W as u};
//# sourceMappingURL=tankStore-BdUoNqf2.js.map
